

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; e3sm_to_cmip 1.6.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> e3sm_to_cmip
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="high_freq.html">High Frequency Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="cwl.html">CWL Workflows</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">e3sm_to_cmip</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<span id="id1"></span><h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="simple-atmosphere-variable-example-no-cwl">
<h2>Simple atmosphere variable example (no CWL)<a class="headerlink" href="#simple-atmosphere-variable-example-no-cwl" title="Permalink to this headline">¶</a></h2>
<p>The first step in converting atmosphere variables by hand is to do the regridding and time-series extraction. For this example, lets assume there’s
a directory named “atmos-input” that contains a single year of cam.h0 monthly history files, and we want to end up with the “pr,” and “clt” variables.</p>
<p>First we ask the e3sm_to_cmip package what source variables are needed for these two output variables, or look them up in the <span class="xref std std-ref">var_map_atm</span></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt; e3sm_to_cmip --info -v pr, clt
<span class="o">[</span>*<span class="o">]</span>
CMIP6 Name: clt,
CMIP6 Table: CMIP6_Amon.json,
CMIP6 Units: %,
E3SM Variables: CLDTOT,
Unit conversion: <span class="m">1</span>-to-%
<span class="o">[</span>*<span class="o">]</span>
CMIP6 Name: pr,
CMIP6 Table: CMIP6_Amon.json,
CMIP6 Units: kg m-2 s-1,
E3SM Variables: PRECC, PRECL
</pre></div>
</div>
<p>From this we can see that the clt variable needs the CLDTOT input variable, and pr needs both PRECC and PRECL.</p>
<p>Next we use ncclimo to extract the time-series and do the regridding. <a class="reference external" href="https://www.youtube.com/watch?v=AJyAjH-1HuA">A detailed tutorial can be found here</a>
Variables specific to your case will be denoted &lt;LIKE THIS&gt;.</p>
<p>In this example Im using files which look like “20191204.BDRD_CNPCTC_SSP585_OIBGC.ne30_oECv3.compy.cam.h0.1850-01.nc”, and so their casename is “20191204.BDRD_CNPCTC_SSP585_OIBGC.ne30_oECv3.compy”.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt; ncclimo --start<span class="o">=</span><span class="m">0001</span> --end<span class="o">=</span><span class="m">0001</span> --ypf<span class="o">=</span><span class="m">1</span> -c &lt;CASENAME&gt; -o ./native -O ./regrid -v CLDTOT,PRECC,PRECL -i ./atmos-input --map<span class="o">=</span>&lt;PATH TO YOUR MAPFILE&gt;
Climatology operations invoked with command:
/export/baldwin32/anaconda3/envs/cwl/bin/ncclimo --start<span class="o">=</span><span class="m">2015</span> --end<span class="o">=</span><span class="m">2015</span> --ypf<span class="o">=</span><span class="m">1</span> -c <span class="m">20191204</span>.BDRD_CNPCTC_SSP585_OIBGC.ne30_oECv3.compy -o ./native --regrid<span class="o">=</span>./regrid -v CLDTOT,PRECC,PRECL -i ./atm_testing -v CLDTOT,PRECC,PRECL --map<span class="o">=</span>/export/zender1/data/maps/map_ne30np4_to_cmip6_180x360_aave.20181001.nc
Started climatology generation <span class="k">for</span> dataset <span class="m">20191204</span>.BDRD_CNPCTC_SSP585_OIBGC.ne30_oECv3.compy at Tue Nov <span class="m">24</span> <span class="m">15</span>:05:20 PST <span class="m">2020</span>
Running climatology script ncclimo from directory /export/baldwin32/anaconda3/envs/cwl/bin
NCO binaries version <span class="m">4</span>.9.3 from directory /export/baldwin32/anaconda3/envs/cwl/bin
Parallelism <span class="nv">mode</span> <span class="o">=</span> background
Timeseries will be created <span class="k">for</span> each of <span class="m">3</span> variables
Background parallelism processing variables in var_nbr/job_nbr <span class="o">=</span> <span class="m">3</span>/3 <span class="o">=</span> <span class="m">1</span> sequential batches of <span class="nv">job_nbr</span> <span class="o">=</span> <span class="m">3</span> simultaneous <span class="nb">jobs</span> <span class="o">(</span><span class="m">1</span> per variable<span class="o">)</span>, <span class="k">then</span> remaining <span class="m">0</span> jobs/variables simultaneously
Will split data <span class="k">for</span> each variable into one timeseries of length <span class="m">1</span> years
Splitting climatology from <span class="m">12</span> raw input files in directory ./atm_testing
Each input file assumed to contain mean of one month
Native-grid split files to directory ./native
Regridded split files to directory ./regrid
Tue Nov <span class="m">24</span> <span class="m">15</span>:05:21 PST <span class="m">2020</span>: Generated ./native/CLDTOT_201501_201512.nc
Tue Nov <span class="m">24</span> <span class="m">15</span>:05:21 PST <span class="m">2020</span>: Generated ./native/PRECC_201501_201512.nc
Tue Nov <span class="m">24</span> <span class="m">15</span>:05:21 PST <span class="m">2020</span>: Generated ./native/PRECL_201501_201512.nc
Tue Nov <span class="m">24</span> <span class="m">15</span>:05:22 PST <span class="m">2020</span>: Regridded ./regrid/CLDTOT_201501_201512.nc
Tue Nov <span class="m">24</span> <span class="m">15</span>:05:22 PST <span class="m">2020</span>: Regridded ./regrid/PRECC_201501_201512.nc
Tue Nov <span class="m">24</span> <span class="m">15</span>:05:22 PST <span class="m">2020</span>: Regridded ./regrid/PRECL_201501_201512.nc
Quick plots of last variable split in last segment:
ncview ./regrid/PRECL_201501_201512.nc <span class="p">&amp;</span>
panoply ./regrid/PRECL_201501_201512.nc <span class="p">&amp;</span>
Completed <span class="m">1</span>-year climatology operations <span class="k">for</span> dataset with <span class="nv">caseid</span> <span class="o">=</span> <span class="m">20191204</span>.BDRD_CNPCTC_SSP585_OIBGC.ne30_oECv3.compy at Tue Nov <span class="m">24</span> <span class="m">15</span>:05:22 PST <span class="m">2020</span>
Elapsed <span class="nb">time</span> 0m2s
</pre></div>
</div>
<p>Now that we have appropriate input files, we can run the converter package.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt; e3sm_to_cmip -i regrid/ -o cmip_output -v prc, clt -t &lt;PATH TO CMIP6 TABLES&gt; -u &lt;PATH TO CMOR USER INPUT JSON&gt;
<span class="o">[</span>*<span class="o">]</span> Writing log output to: cmip_output/converter.log
<span class="o">[</span>+<span class="o">]</span> Running CMOR handlers in parallel
<span class="m">100</span>%<span class="p">|</span>███████████████████████████████████████<span class="p">|</span> <span class="m">2</span>/2 <span class="o">[</span><span class="m">00</span>:01&lt;<span class="m">00</span>:00,  <span class="m">1</span>.96it/s<span class="o">]</span>
<span class="o">[</span>+<span class="o">]</span> <span class="m">2</span> of <span class="m">2</span> handlers <span class="nb">complete</span>
</pre></div>
</div>
<p>Alternately, if this isnt going to be published to CMIP6, we can use the “simple” mode which doesnt require the full CMIP6 tables or metadata</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt; python -m e3sm_to_cmip -i regrid -o cmip_output -v prc, clt --simple
<span class="o">[</span>*<span class="o">]</span> Writing log output to: cmip_output/converter.log
<span class="o">[</span>+<span class="o">]</span> Running CMOR handlers in parallel
<span class="o">[</span>+<span class="o">]</span> writing out variable to file /cmip_output/prc_CMIP6_Amon_201501-201512.nc                                                                                                                                                                                                                                              <span class="p">|</span> <span class="m">0</span>/2 <span class="o">[</span><span class="m">00</span>:00&lt;?, ?it/s<span class="o">][</span>+<span class="o">]</span> writing out variable to file /p/user_pub/e3sm/baldwin32/workshop/ssp585/ssp585/output/pp/cmor/ssp585/2015_2100/cmip_output/prc_CMIP6_Amon_201501-201512.nc
<span class="o">[</span>+<span class="o">]</span> writing out variable to file /cmip_output/clt_CMIP6_Amon_201501-201512.nc
<span class="m">100</span>%<span class="p">|</span>███████████████████████████████████████<span class="p">|</span> <span class="m">2</span>/2 <span class="o">[</span><span class="m">00</span>:00&lt;<span class="m">00</span>:00,  <span class="m">6</span>.79it/s<span class="o">]</span>
<span class="o">[</span>+<span class="o">]</span> <span class="m">2</span> of <span class="m">2</span> handlers <span class="nb">complete</span>
</pre></div>
</div>
</div>
<div class="section" id="plev-atmosphere-variable-example-no-cwl">
<h2>Plev atmosphere variable example (no CWL)<a class="headerlink" href="#plev-atmosphere-variable-example-no-cwl" title="Permalink to this headline">¶</a></h2>
<p>Some 3D atmosphere CMIP6 variables are on the plev19 vertical levels instead of the model and require remapping from the default model levels to the plev19 levels.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt; e3sm_to_cmip --info -v hus
<span class="o">[</span>*<span class="o">]</span>
CMIP6 Name: hus,
CMIP6 Table: CMIP6_Amon.json,
CMIP6 Units: <span class="m">1</span>,
E3SM Variables: Q
Levels: <span class="o">{</span><span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;plev19&#39;</span>, <span class="s1">&#39;units&#39;</span>: <span class="s1">&#39;Pa&#39;</span>, <span class="s1">&#39;e3sm_axis_name&#39;</span>: <span class="s1">&#39;plev&#39;</span><span class="o">}</span>
</pre></div>
</div>
<p>Before performing the horizontal remapping, run the following command using the vertical remapping file <a class="reference external" href="https://github.com/E3SM-Project/e3sm_to_cmip/blob/master/e3sm_to_cmip/resources/vrt_remap_plev19.nc?raw=true">which can be found here</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir vrt_regrid
<span class="k">for</span> file in <span class="sb">`</span>ls atm-input<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> ncks --rgr <span class="nv">xtr_mth</span><span class="o">=</span>mss_val --vrt_fl<span class="o">=</span>vrt_remap_plev19.nc ./atm-input/<span class="nv">$file</span> ./vrt_regrid/<span class="nv">$file</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
<p>The output files will be converted from the default 72 vertical levels which come out of the E3SM model into 19 vertical levels defined by the CMIP6 project.
These files can then be regridded and converted as in the “Simple” example above.</p>
</div>
<div class="section" id="atmosphere-example-using-cwl">
<h2>Atmosphere example using CWL<a class="headerlink" href="#atmosphere-example-using-cwl" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Sterling Baldwin

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>